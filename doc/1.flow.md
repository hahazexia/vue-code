# flow

flow 是一个 js 的静态检查工具。它通过两种方式来检查代码中可能出现的类型错误。

* 第一种是通过静态类型注释的方式：

```js
// @flow
function square(n: number): number {
  return n * n;
}

square("2"); // Error!
```

通过显式地注释标出 square 函数的参数 n 期望是 number 类型，以及 square 函数的返回值期望 number 类型。

* 第二种是让 flow 自己来判断是否变量有类型错误:

```js
// @flow
function square(n) {
  return n * n; // Error!
}

square("2");
```

不需要显示地标出期望的类型，只在代码文件第一行加上 `// @flow` 注释，让 flow 自行判断是否有类型错误。

## 安装

* 编译器

在项目中使用 flow 首先需要安装一个编译器，用来剥离 flow 的类型定义。可以选用 [babel](https://babeljs.io/) 或者 [flow-remove-types](https://www.npmjs.com/package/flow-remove-types)。我们这里选用 babel 作为编译器。

```js
yarn add --dev @babel/core @babel/cli @babel/preset-flow
```

运行上面命令安装 `@babel/core` `@babel/cli` `@babel/preset-flow` 这三个依赖后，在 `babel.config.js` 中添加 `presets` 设置：

```js
// babel.config.js

module.exports = {
  presets: [
    '@babel/preset-flow'
  ]
}

```

* 安装 flow

flow 最好给每个项目安装明确指定的版本而不是全局安装。

```js
//安装 flow
yarn add --dev flow-bin

//运行 flow
yarn run flow
```

## 用法

对于一个新的 flow 项目来说，一般遵循下面几点来使用 flow ：

* 使用 `flow init` 来初始化

```js
flow init
```

运行这句命令后会在项目根目录下生成 `.flowconfig` 文件。这个文件会告诉 flow 的后台进程如何去检查代码中的错误。


* 运行 flow 的后台进程

```js
flow status
```

这个命令会启动一个后台进程检查所有 flow 文件的错误，它会一直运行监测文件的变化然后检查错误。运行 `flow stop` 来停止后台进程。


* 使用 `// @flow` 决定哪些文件会被 flow 监测

在想要被 flow 检查的文件的第一行添加注释 `// @flow` 即可，这样 flow 就会自动检查这个文件。也可以用 `/* @flow */`。

* 为项目写 flow 代码

为函数写 flow 代码，例如：

```js
// @flow

function foo(x: ?number): string {
  if (x) {
    return x;
  }
  return "default string";
}
```

* 用 flow 检查类型错误

直接运行 `flow` 即可启动检查程序。

## 类型注释

